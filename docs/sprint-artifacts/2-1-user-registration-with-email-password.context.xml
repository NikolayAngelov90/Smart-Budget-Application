<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>1</storyId>
    <title>User Registration with Email/Password</title>
    <status>drafted</status>
    <generatedAt>2025-11-16</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-1-user-registration-with-email-password.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a new user</asA>
    <iWant>to create an account using my email and password</iWant>
    <soThat>I can securely access my financial data from any device</soThat>
    <tasks>
      - Create signup page component at `/app/(auth)/signup/page.tsx`
      - Implement form with React Hook Form + Zod validation schema
      - Add email and password fields with validation
      - Implement password strength meter (weak/medium/strong)
      - Add password confirmation field
      - Call `supabase.auth.signUp()` on form submission
      - Handle success case (show message, redirect to verification page)
      - Handle error cases (email exists, network failure, rate limiting)
      - Style with Chakra UI components (Trust Blue theme)
      - Ensure responsive design (mobile + desktop)
      - Add ARIA labels for accessibility
      - Ensure 44x44px touch targets on mobile
      - Test keyboard navigation
    </tasks>
  </story>

  <acceptanceCriteria>
    **Given** I am a new user on the signup page
    **When** I fill out the registration form and submit
    **Then** My account is created successfully

    **And** Email field validates RFC 5322 email format
    **And** Password requirements enforced: minimum 8 characters, 1 uppercase, 1 number, 1 special character
    **And** Password strength meter shows visual feedback (weak/medium/strong)
    **And** Password confirmation field must match password
    **And** Form uses React Hook Form + Zod for validation
    **And** Inline validation errors appear below fields in red
    **And** Submit button disabled until form is valid
    **And** Registration completes in &lt; 2 seconds (optimistic UI)
    **And** Verification email sent within 15 minutes
    **And** Success message displayed: "Account created! Check your email to verify."
    **And** User redirected to email verification waiting page
    **And** Touch targets minimum 44x44px on mobile
    **And** Form fully keyboard accessible with visible focus indicators
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-2.md</path>
        <title>Epic 2: User Authentication & Onboarding - Technical Context</title>
        <section>Story 2.1: User Registration with Email/Password</section>
        <snippet>Build a client component form using Chakra UI components. Use react-hook-form and a zod schema to manage form state and validation (password strength, email format). On submit, call supabase.auth.signUp() method. Handle success by showing a message prompting the user to check their email. Handle errors such as "User already registered".</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Technical Architecture</title>
        <section>ADR-008: Form Handling</section>
        <snippet>Use React Hook Form with Zod for schema validation. Performance: Minimal re-renders (uncontrolled inputs) crucial for sub-30-second entry. Validation: Zod provides type-safe schema validation with TypeScript inference.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>Visual Foundation - Color System - Trust Blue Theme</section>
        <snippet>Primary: #2b6cb0 for main actions and primary buttons. Semantic Colors - Error: #e53e3e for validation errors. Typography - System font stack. Touch targets minimum 44x44px on mobile.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 2: Story 2.1 Technical Notes</section>
        <snippet>Create /app/(auth)/signup/page.tsx. Use React Hook Form + Zod schema for validation. Implement password strength calculation (zxcvbn library optional). Call supabase.auth.signUp({ email, password }). Style with Chakra UI components. Responsive design: single column on mobile, centered card on desktop. ARIA labels for screen readers.</snippet>
      </doc>
    </docs>
    <code>
      <file>
        <path>src/lib/supabase/client.ts</path>
        <kind>service</kind>
        <symbol>createClient</symbol>
        <lines>24-28</lines>
        <reason>Supabase browser client used for auth.signUp() calls in signup form</reason>
      </file>
      <file>
        <path>src/app/(auth)/signup/page.tsx</path>
        <kind>component</kind>
        <symbol>SignupPage</symbol>
        <lines>1-84</lines>
        <reason>Current placeholder signup page that needs to be replaced with full implementation</reason>
      </file>
      <file>
        <path>src/app/(auth)/login/page.tsx</path>
        <kind>component</kind>
        <symbol>LoginPage</symbol>
        <lines>all</lines>
        <reason>Reference for similar auth form structure and styling patterns</reason>
      </file>
      <file>
        <path>src/types/database.types.ts</path>
        <kind>types</kind>
        <symbol>Database</symbol>
        <lines>all</lines>
        <reason>Type-safe database schema for Supabase client (auto-generated types)</reason>
      </file>
    </code>
    <dependencies>
      <node>
        <package name="@chakra-ui/react" version="^2.8.0" status="installed">UI components for form inputs, buttons, error messages</package>
        <package name="@supabase/supabase-js" version="^2.81.1" status="installed">Authentication service for signUp method</package>
        <package name="next" version="^15.0.0" status="installed">React framework with App Router</package>
        <package name="react-hook-form" version="^7.0.0" status="missing">Form state management with minimal re-renders (REQUIRED)</package>
        <package name="zod" version="^3.0.0" status="missing">Type-safe schema validation (REQUIRED)</package>
        <package name="@hookform/resolvers" version="^3.0.0" status="missing">Integrates Zod with React Hook Form (REQUIRED)</package>
        <package name="zxcvbn" version="^4.4.2" status="optional">Password strength calculation (optional enhancement)</package>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    - Use React Hook Form + Zod for all form validation (ADR-008)
    - Follow Chakra UI Trust Blue theme (#2b6cb0 for primary actions)
    - Ensure WCAG 2.1 Level A minimum accessibility compliance
    - File naming: PascalCase for components (SignupPage.tsx)
    - Use TypeScript strict mode with full type coverage
    - Implement optimistic UI for perceived performance (&lt;2s registration)
    - Session stored in httpOnly cookies (handled by @supabase/ssr)
    - All errors display user-friendly messages (not technical details)
    - Touch targets must be 44x44px minimum on mobile
    - Form must be fully keyboard accessible (Tab, Enter navigation)
    - Inline validation errors shown in real-time below fields
    - Password requirements: min 8 chars, 1 uppercase, 1 number, 1 special char
  </constraints>

  <interfaces>
    <interface>
      <name>Supabase Auth - signUp</name>
      <kind>API Method</kind>
      <signature>supabase.auth.signUp({ email: string, password: string }): Promise&lt;{ data, error }&gt;</signature>
      <path>@supabase/supabase-js</path>
    </interface>
    <interface>
      <name>React Hook Form - useForm</name>
      <kind>React Hook</kind>
      <signature>useForm&lt;FormData&gt;({ resolver: zodResolver(schema) })</signature>
      <path>react-hook-form</path>
    </interface>
    <interface>
      <name>Zod Schema</name>
      <kind>Validation Schema</kind>
      <signature>z.object({ email: z.string().email(), password: z.string().min(8).regex(...) })</signature>
      <path>zod</path>
    </interface>
    <interface>
      <name>Chakra UI Form Components</name>
      <kind>UI Components</kind>
      <signature>FormControl, FormLabel, FormErrorMessage, Input, Button</signature>
      <path>@chakra-ui/react</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Unit tests using Jest + React Testing Library for form validation logic.
      Integration tests to verify Supabase client calls with mocked responses.
      E2E tests using Playwright for full signup flow (form submission, success/error states).
      Accessibility tests to ensure WCAG 2.1 Level A compliance (keyboard navigation, ARIA labels, focus indicators).
    </standards>
    <locations>
      src/__tests__/components/auth/SignupPage.test.tsx
      src/__tests__/integration/signup.integration.test.ts
      e2e/auth/signup.spec.ts
    </locations>
    <ideas>
      - **AC1**: Test email validation with valid and invalid formats
      - **AC2**: Test password validation (min length, complexity requirements)
      - **AC3**: Test password strength meter shows correct feedback (weak/medium/strong)
      - **AC4**: Test password confirmation field must match
      - **AC5**: Test form submission calls supabase.auth.signUp with correct parameters
      - **AC6**: Test success case shows "Account created! Check your email" message
      - **AC7**: Test error case "Email already registered" displays correctly
      - **AC8**: Test network error displays user-friendly message
      - **AC9**: Test submit button disabled when form invalid
      - **AC10**: Test keyboard navigation (Tab, Enter to submit)
      - **AC11**: Test touch targets are 44x44px on mobile viewport
      - **AC12**: Test ARIA labels present for screen readers
    </ideas>
  </tests>
</story-context>
